{% extends "base.html" %}



{% block content %}

    <select id="s">
        <option value="1977">1977</option>
        <option value="1978">1978</option>
        <option value="1979">1979</option>
        <option value="1980">1980</option>
        <option value="1981">1981</option>
        <option value="1982">1982</option>
        <option value="1983">1983</option>
        <option value="1984">1984</option>
        <option value="1985">1985</option>
        <option value="1986">1986</option>
        <option value="1987">1987</option>
        <option value="1988">1988</option>
        <option value="1989">1989</option>
        <option value="1990">1990</option>
        <option value="1991">1991</option>
        <option value="1992">1992</option>
        <option value="1993">1993</option>
        <option value="1994">1994</option>
        <option value="1995">1995</option>
        <option value="1996">1996</option>
        <option value="1997">1997</option>
        <option value="1998">1998</option>
        <option value="1999">1999</option>
        <option value="2000">2000</option>
        <option value="2001">2001</option>
        <option value="2002">2002</option>
        <option value="2003">2003</option>
        <option value="2004">2004</option>
        <option value="2005">2005</option>
        <option value="2006">2006</option>
        <option value="2007">2007</option>
        <option value="2008">2008</option>
        <option value="2009">2009</option>
        <option value="2010">2010</option>
        <option value="2011">2011</option>
        <option value="2012">2012</option>
        <option value="2013">2013</option>
        <option value="2014">2014</option>
    </select>

    <!-- Button trigger modal -->
    <button class="btn btn-info" data-toggle="modal" data-target="#info-modal">
        <i class="fa fa-info"></i>
    </button>

    <!-- Modal -->
    <div class="modal fade" id="info-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">Theses gender distribution</h4>
                </div>

                <div class="modal-body">
                    <p>
                        This chart shows the panel member's gender distribution from all the doctoral defenses registered in Spain since 1977.
                    </p>

                    <p>
                        When hovering over each bar, a tooltip with gender distribution information shows up.
                    </p>

                    <p>
                        Remember that viva panels in Spain are formed by 5 tribunal members.
                    </p>

                    <p>
                        To calculate the presence of each gender in those panels, the number of gender-unknown members is deducted from that year's total count. This could lead to data misinterpretations, as some data are missing in the analysis. Improving the gender desambiguation could lead to more realistic results.
                    </p>

                    <p>
                        This chart is closely related with the <a href="{{ url_for('theses_gender_distribution') }}">Thesis gender distribution</a> chart.
                    </p>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div id="geo-chart" class="centered"></div>

{% endblock %}



{% block scripts %}

    <script type="text/javascript" src="{{ url_for('static', filename='js/d3.min.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/gcharts.js') }}"></script>

    <script>
        var regions = {
            "Andalucía": "ES-AN",
            "Aragon": "ES-AR",
            "Asturias": "ES-AS",
            "Islas Canarias": "ES-CN",
            "Cantabria": "ES-CB",
            "Castilla La Mancha": "ES-CM",
            "Castilla y León": "ES-CL",
            "Cataluña": "ES-CT",
            "Extremadura": "ES-EX",
            "Galicia": "ES-GA",
            "Islas Baleares": "ES-IB",
            "La Rioja": "ES-RI",
            "Madrid": "ES-MD",
            "Murcia": "ES-MC",
            "Navarra": "ES-NC",
            "País Vasco": "ES-PV",
            "Valencia": "ES-VC",
            "Ceuta": "ES-CE",
            "Melilla": "ES-ML",
        }

        var regions_json;
        $.getJSON("{{ url_for('static', filename='data/regions_temporal.json') }}", function(json) {
            regions_json = json;
        });

        var year = 1977;

        google.load('visualization', '1', {'packages': ['geochart']});
        google.setOnLoadCallback(drawRegionsMap);

        function drawRegionsMap() {
            var dataTable = new google.visualization.DataTable();

            dataTable.addColumn('string', 'Region');
            dataTable.addColumn('number', 'Number of theses');

            for (var element in regions_json[String(year)]) {
                // console.log(regions[String(element)], regions_json[2008][String(element)]);
                dataTable.addRow([regions[String(element)], regions_json[String(year)][String(element)]]);
            }

            var options = {
                region: 'ES',
                resolution: 'provinces',
                displayMode: 'regions',
                colorAxis: {minValue: 0,  colors: ['#fff', '#00f']}
            };

            var chart = new google.visualization.GeoChart(document.getElementById('geo-chart'));
            chart.draw(dataTable, options);
        };

        $('#s').change(function() {
            year = $( "#s option:selected" ).text();
            drawRegionsMap();
        });



        // d3.xml("{{ url_for('static', filename='spain.svg') }}", "image/svg+xml", function(xml) {
        //     document.body.appendChild(xml.documentElement);
        // });

        // // http://en.wikipedia.org/wiki/ISO_3166-2:ES

        // $('#xxx').attr("id","ES-AN");   // Andalucía
        // $('#xxx').attr("id","ES-AR");   // Aragón
        // $('#xxx').attr("id","ES-AS");   // Asturias
        // $('#xxx').attr("id","ES-CN");   // Canarias
        // $('#xxx').attr("id","ES-CB");   // Cantabria
        // $('#xxx').attr("id","ES-CM");   // Castilla la Mancha
        // $('#xxx').attr("id","ES-CL");   // Castilla y León
        // $('#xxx').attr("id","ES-CT");   // Cataluña
        // $('#xxx').attr("id","ES-EX");   // Extremadura
        // $('#xxx').attr("id","ES-GA");   // Galicia
        // $('#xxx').attr("id","ES-IB");   // Islas Baleares
        // $('#xxx').attr("id","ES-RI");   // La Rioja
        // $('#xxx').attr("id","ES-MD");   // Comunidad de Madrid
        // $('#xxx').attr("id","ES-MC");   // Murcia
        // $('#xxx').attr("id","ES-NC");   // Navarra
        // $('#xxx').attr("id","ES-PV");   // País Vasco
        // $('#xxx').attr("id","ES-VC");   // Comunidad Valenciana
        // $('#xxx').attr("id","ES-CE");   // Ceuta
        // $('#xxx').attr("id","ES-ML");   // Melilla
    </script>

{% endblock %}
